
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ONIContext &#8212; Open Ephys ONIX  documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/blank.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/copyURLToClipboard.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HeartbeatDevice" href="HeartbeatDevice.html" />
    <link rel="prev" title="Getting Started" href="GettingStarted.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/onix_open_ephys_logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../Getting%20Started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../Hardware%20Guide/index.html">
  Hardware Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../API%20Reference/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Software Guide
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://open-ephys.org">Open Ephys<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/open-ephys/onix-docs" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/openephys" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://open-ephys.slack.com" rel="noopener" target="_blank" title="Slack">
            <span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Bonsai.ONIX
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Installation.html">
     Installation
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="GettingStarted.html">
     Getting Started
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     ONIContext
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="HeartbeatDevice.html">
     HeartbeatDevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="AnalogIODevice.html">
     AnalogIODevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="DigitalIODevice.html">
     DigitalIODevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ClockOutputDevice.html">
     ClockOutputDevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="HeadstagePortControlDevice.html">
     HeadstagePortControlDevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="BNO055Device.html">
     BNO055Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="TS4231V1Device.html">
     TS4231V1Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RHD2164Device.html">
     RHD2164Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ElectricalStimulationDevice.html">
     ElectricalStimulationDevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="OpticalStimulationDevice.html">
     OpticalStimulationDevice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NeuropixelsV1Device.html">
     NeuropixelsV1Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="MiniscopeV3Device.html">
     MiniscopeV3Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="MiniscopeV4Device.html">
     MiniscopeV4Device
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="MiniscopeV4BNO055Device.html">
     MiniscopeV4BNO055Device
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Bonsai%20Examples/index.html">
   Example Workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Bonsai%20Examples/Headstage64.html">
     Headstage-64 Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Bonsai%20Examples/LatencyTest.html">
     Latency Test Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Bonsai%20Examples/CameraSync.html">
     Camera Synchronization Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Bonsai%20Examples/Commutator.html">
     Manual Commutator Workflow
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#purpose">
   Purpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configuration-gui">
   Configuration GUI
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#settings-hubs">
     Settings ➞  Hubs…
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#settings-host-sync">
     Settings ➞  Host Sync…
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/open-ephys/onix-docs/edit/main/source/Software Guide/Bonsai.ONIX/ONIContext.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="onicontext">
<span id="bonsai-onicontext"></span><h1>ONIContext<a class="headerlink" href="#onicontext" title="Permalink to this headline">¶</a></h1>
<p>A <a class="reference external" href="https://bonsai-rx.org/docs/editor/#toolbox">Bonsai source</a> that manages a
<a class="reference internal" href="../../API%20Reference/liboni/oni.html#oni-h-acquisition-context"><span class="std std-ref">Acquisition Context</span></a> and allows basic acquisition parameterization.
There must be at least one of these in every workflow that uses ONIX hardware.</p>
<dl class="field-list simple">
<dt class="field-odd">Inputs</dt>
<dd class="field-odd"><p>None</p>
</dd>
<dt class="field-even">Outputs</dt>
<dd class="field-even"><p>A single <code class="docutils literal notranslate"><span class="pre">ONIContextTask</span></code> followed by <a class="reference external" href="http://reactivex.io/documentation/operators/empty-never-throw.html">Never</a>.</p>
</dd>
</dl>
        <div class="bonsai-workflow-container">
    <div class="workflow-filler"></div>
    <div class="workflow-download"><img class="copy-img" src="../../_static/download.svg" onclick="getTextFromURL('../../_static/bonsai/workflows/ONIContext.bonsai', true)" width=18px download/></div>
    <div class="workflow-copy"><img class="copy-img" src="../../_static/copy.svg" onclick="getTextFromURL('../../_static/bonsai/workflows/ONIContext.bonsai')" width=18px /></div>
    <div class="workflow-name"><b>ONIContext.bonsai</b></div>
    <div class="workflow-image"><img src="../../_static/bonsai/workflows/ONIContext.svg" alt="ONIContext" /></div>
</div><div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Bonsai.ONIX</span></code>’s design mirrors the that of the <a class="reference external" href="https://github.com/open-ephys/ONI">Open Neuro Interface
specification</a>. Control of and
acquisition from ONIX hardware is handled by a combination of two or more
nodes: an <a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> and potentially many <strong>Device</strong> nodes which
it manages (e.g. <a class="reference internal" href="HeartbeatDevice.html#bonsai-heartbeatdev"><span class="std std-ref">HeartbeatDevice</span></a>, <a class="reference internal" href="AnalogIODevice.html#bonsai-analogiodev"><span class="std std-ref">AnalogIODevice</span></a>, etc.). Some
facts about the <a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> node are useful for understanding how
to use it.</p>
<div class="figure align-center" id="id1">
<img alt="../../_images/bonsai-library-architecture.jpg" src="../../_images/bonsai-library-architecture.jpg" style="width: 500px;" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> is responsible for communicating with hardware and
the informing devices, identified using their DeviceAddress, that they have
new data.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>An <a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> manages a global <strong>Device Table</strong>. When it is
placed in a workflow, all device nodes will automatically have access to to
this table without requiring an explicit connection in the workflow.</p></li>
<li><p>When acquisition is started, the <a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> node will produce a
single <code class="docutils literal notranslate"><span class="pre">ONIContextTask</span></code> and then nothing. This “task” runs in the background
until the workflow is stopped.</p></li>
<li><p>When the workflow is running, the <code class="docutils literal notranslate"><span class="pre">ONIContextTask</span></code> uses a dedicated thread
to read from the host hardware. It then passes data into a blocking queue
which is read by a second thread that is responsible for informing individual
device nodes that they have new samples.</p></li>
<li><p>Device nodes are essentially filters for the data stream produced by
<a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a>. Device nodes will accept samples that match their
<strong>DeviceAddress</strong>. This is why each Device node has an DeviceAddress
parameter that unambiguously identifies them them in a Device Table.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Every Bonsai workflow must include at least a single
<a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> which manages a single device table. If multiple
pieces of host acquisition hardware (e.g. multiple <a class="reference internal" href="../../Hardware%20Guide/PCIe%20Host/index.html#pcie-host"><span class="std std-ref">PCIe Host</span></a>) are
present in a single computer, then each will need its own
<a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> to manage it.</p>
</div>
</div>
<div class="section" id="configuration-gui">
<h2>Configuration GUI<a class="headerlink" href="#configuration-gui" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> configuration is performed using a GUI provided in the
Bonsai.ONIX.Design library. It can be opened by double clicking on the
<a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> node if Bonsai.ONIX.Design has been installed.</p>
<img alt="../../_images/ONIContext_configuration.png" class="align-center" src="../../_images/ONIContext_configuration.png" />
<p>This GUI gives access to ONI Context configuration such as as well as the
complete <strong>Device Table</strong>. Devices within the table are available for configuration
using the <strong>Properties Pane</strong> on the right side of the form.</p>
<ol class="arabic simple">
<li><p><strong>Settings</strong>: Drop down menu that provides several hardware configuration options</p></li>
<li><p><strong>Driver</strong>: The device driver used to control the host hardware.</p></li>
<li><p><strong>Slot</strong>: The physical slot of the Host hardware in the computer.</p></li>
<li><p><strong>Read Block Size</strong>: The number of bytes read per call to the kernel driver.
Larger numbers <em>will generally</em> increase overall bandwidth and decrease
response latency.</p></li>
<li><p><strong>Write Block Size</strong>: The number of bytes pre-allocated to make output for output
data frames. Larger numbers <em>may</em> increase overall bandwidth and decrease
response latency.</p></li>
<li><p><img alt="refresh_icon" src="../../_images/ONIContext_refresh-icon.png" style="height: 19px;" /> <strong>&lt;status&gt;</strong>: Shows the current host hardware connection status.
Clicking will attempt to reconnect to the host hardware.</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Optimal values of <strong>Read Block Size</strong> and <strong>Write Block Size</strong> depend heavily
on the computer being used and the devices being acquired from: e.g.  how many
devices, at what sample rate, at what frame size, etc.  Experimentation will be
required to get the lowest response latency. The <a class="reference internal" href="../Bonsai%20Examples/LatencyTest.html#bonsai-latencytest"><span class="std std-ref">Latency Test Workflow</span></a>
workflow provides a way for users to do this quickly for their hardware setup.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Changes to device registers using the <a class="reference internal" href="#bonsai-onicontext"><span class="std std-ref">ONIContext</span></a> GUI will
not be saved in the workflow file. To save device register values to file,
device configuration must be performed using dedicated device nodes.</p>
</div>
<div class="section" id="settings-hubs">
<span id="bonsai-onicontext-hubsettings"></span><h3>Settings ➞  Hubs…<a class="headerlink" href="#settings-hubs" title="Permalink to this headline">¶</a></h3>
<p>ONIX-specific hub options such as access to raw deserializer data streams:</p>
<img alt="../../_images/ONIContext_hub-configuration.png" class="align-center" src="../../_images/ONIContext_hub-configuration.png" />
<dl class="field-list simple">
<dt class="field-odd">Standard</dt>
<dd class="field-odd"><p>The hub port is configured to work with official ONIX headstages.</p>
</dd>
<dt class="field-even">Passthrough</dt>
<dd class="field-even"><p>The hub port is configured to work with compatible
3rd-party devices, such as UCLA Miniscopes.</p>
</dd>
</dl>
</div>
<div class="section" id="settings-host-sync">
<span id="bonsai-onicontext-syncsettings"></span><h3>Settings ➞  Host Sync…<a class="headerlink" href="#settings-host-sync" title="Permalink to this headline">¶</a></h3>
<p>Hardware synchronization configuration for two or more hosts that are connected
with a synchronization cable.</p>
<img alt="../../_images/ONIContext_host-sync.png" class="align-center" src="../../_images/ONIContext_host-sync.png" />
<dl class="field-list simple">
<dt class="field-odd">Standalone</dt>
<dd class="field-odd"><p>Acquisition for this host is independent from others host hardware. It
will run on its own clock and start using an internal trigger.</p>
</dd>
<dt class="field-even">Source</dt>
<dd class="field-even"><p>The host runs in Standalone mode and shares its acquisition start
trigger to the selected <em>Sync Channel</em>. There is only one Source allowed
per synchronization channel.</p>
</dd>
<dt class="field-odd">Listener</dt>
<dd class="field-odd"><p>The host is synchronized to the <em>Source</em> hardware on the
selected <em>Sync Channel</em>. Any number of listeners can be assigned to a
single <em>Sync Channel</em>.</p>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Only the aquisition start trigger is shared from Sources to
Listeners. The acquisition clock may or may not be shared depending on the
type of host hardware being used. For example, if all hardware consists of
<a class="reference internal" href="../../Hardware%20Guide/PCIe%20Host/index.html#pcie-host"><span class="std std-ref">PCIe Hosts</span></a> on the same motherboard, then both start
trigger and acquisition clocks will be shared and synchronization ed.
Multiple USB hosts will only share a start trigger and the acquisition
clocks will drift over time.</p>
</div>
</div>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="GettingStarted.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Getting Started</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="HeartbeatDevice.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HeartbeatDevice</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2010-2022, Open Ephys &amp; Contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>